
<!DOCTYPE html>
<html lang="en">
  <head>
    <script type="text/javascript" src="bregdivs.js"></script>
    <script type="text/javascript" charset="UTF-8"
 src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css">
    <!-- The loading of KaTeX is deferred to speed up page rendering -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js"></script>
    <!-- To automatically render math in text elements -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body);"></script>
        <script src="all.min.js"></script>
    <script src="statistics.min.js" type="text/javascript"></script>
    <link rel="icon" type="image/png" href="alex-assets/mlu_robot.png" />
    <link rel="stylesheet" href="alex-assets/styles/normalize.css" />
    <link rel="stylesheet" href="alex-assets/styles/font.css" />
    <link rel="stylesheet" href="alex-assets/styles/katex.css" />
    <link rel="stylesheet" href="alex-assets/styles/global.css" />
    <link rel="stylesheet" href="alex-assets/bundle.css" />
    <link rel="stylesheet" href='success.css'>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.5.0/math.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>


    <!--<script defer src="alex-assets/bundle.js"></script> this does loads -->

    <!-- meta tags -->
    <title>Bregman Divergences</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="description"
      content="A visual, interactive explanation of Bregman Divergences."
    />
    <meta name="author" content="Alexander Cheetham" />
    <!-- <meta
      name="news_keywords"
      content="linear regression classification threshold binary visual machine learning mean squared error r-squared gradient descent closed form least squares interpretability multivariate"
    />
    -->
    <meta property="og:title" content="Bregman Divergences" />

    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en_US" />

    <meta property="og:image:type" content="image/jpg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="600" />
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>

<body>
  <section id="intro" style=' width: 60%; margin: auto;text-align: center' >
      <h1 id="intro-hed">Bregman Divergences</h1>
      <h2 id="intro-sub" style='font-family: "Amazon Ember Mono"'>A Visual Introduction to Bregman Divergences</h2>
      <h3 id="intro__date"  style='font-family: "Amazon Ember Mono"'><a >Alexander Cheetham</a>, September 2022</h3>
</section>

<br>
<section class='panel'>
<h2 class="body-header">Introduction</h2>
<p class="body-text">
<span class="bold">Some subtitles will go here</span>
<br>
I will Fill the introduction in retrospectively once the project is complete
</p>
</section>
<section class='panel'>
<h2 class="body-header">History</h2>
<p class="body-text">
The Bregman divergence first appeared in a paper on solutions to convex
programming problems.
<br>
<img src="./alex-assets/images/paper-title.png" alt="Bregman Paper">
<br>
Appearing first in the section below.
<br>
<br>
<img src="./alex-assets/images/Definition.png" alt="Bregman Paper">
<br>
The definition of a Bregman divergence (retrospectively named such) was defined
in equation (1.4) as a result of trying a function that satisfied the
conditions below.
<br>
<br>
<img src="./alex-assets/images/Conditions1.png" alt="Bregman Paper">
<img src="./alex-assets/images/Conditions2.png" alt="Bregman Paper">
<br>
We will go deeper into some of these properties later in the article.
</p>
</section>
<section class='panel'>
<h2 class="body-header">Motivation and Derivation</h2>
<p class='body-text'>
The motivation for studying Bregman divergences comes from the idea of trying to
generalise the definition of squared Euclidean distance to a larger class of
distances that share the same properties. Alongside this, as we will see later
Bregman divergences have strong ties to applications in probability, machine
learning and clustering. \(\textcolor{red}{CITE\, mirrodescient motivation}\)
<br>
<br>
With this motivation in mind we will first generalise the
squared Euclidean distance(SED) between two points to a Bregman Divergence. Given two
points \( x,y \in \, \mathbb{R}^n \) the SED is: \(\textcolor{red}{CITE\, webarchive}\)
$$d^2(x,y):=\sum_{i=1}^{n} (x_i - y_i)^2 $$
We can rewrite the definition of the
SED in terms of the inner product (\( \langle x,y \rangle = \sum_{i=1}^{d} x_iy_i  \) ).
$$d^2(x,y):=\sum_{i=1}^{n} (x_i - y_i)^2 = \langle x-y,x-y \rangle $$
Then after some manipulation we get.
$$d^2(x,y) =  \langle x-y,x-y \rangle = \mid\mid x \mid\mid^2 -
 \mid\mid y \mid\mid^2 - \langle 2y,x-y \rangle $$

 <button class="btn btn-outline-primary" type="button" data-toggle="collapse" data-target="#proof1" aria-expanded="false" aria-controls="collapseExample">
    Explanation
  </button>
  </p>
  <div class="collapse" id="proof1">
  <div class="card card-body body-text">
    <p class='body-text'>
      $$\langle x-y,x-y \rangle=||x||^2 + ||y||^2 + ||2yx||$$
      $$||x||^2 + ||y||^2 + ||2yx|| = ||x||^2 - ||y||^2 + ||2y^2||+ ||2yx||$$
      $$||x||^2 - ||y||^2 + ||2y^2||+ ||2yx||=||x||^2- ||y||^2 - (||2y^2||- ||2yx||)$$
      $$\langle 2y,x-y \rangle = |2y^2||- ||2yx||$$
      $$||x||^2- ||y||^2 - (||2y^2||- ||2yx||)=||x||^2- ||y||^2 - \langle 2y,x-y \rangle$$
  </p>
  </div>
</div>
<p class="body-text">
And after noticing that \( \frac{d}{dy}||y^2|| = 2y \) we can now rewrite the
equation in terms of the derivative of a function namely \( f(x)=x^2\)
$$d^2(x,y) = f(x) - (f(y) + \langle\nabla f(y),x-y\rangle) $$
<br>
After comparing to bregman's paper below we see that the definitions do indeed
match and therefore SED is a bregman divergence!
<br>
<img src="./alex-assets/images/Definition.png" alt="Bregman Paper">
<br>
This also lends itself to a particularly nice geometrical interpretation if we
realise that \( f(y) + \langle\nabla f(y),x-y\rangle \) is the tangent line of f
at y.
<br>
<br>
<div id="box" class="jxgbox" style="width:45%; height:70vh; margin: auto;"></div>
<script type="text/javascript">


 var board = JXG.JSXGraph.initBoard('box', {boundingbox: [-10, 10, 12, -4]});
 board.options.text.cssStyle = 'font-family: "Amazon Ember Mono"'
 var xaxis = board.create('axis', [[0.0, 0.0], [0.0, 1]]);
 var yaxis = board.create('axis', [[0.0, 0.0], [1.0, 0]]);

 theSlider = board.create('slider',[[-9,8],[-4,8],[0,0.1,1]],
  {snapWidth:0.05});
  board.create('text',[-9,8.5,
   function(){

     return 'f(x) = '+Math.round(theSlider.Value()* 100) / 100+'x^2';
   }], {fontSize: 15,})
 theFct = board.create('functiongraph',
   [function(x){return theSlider.Value()*x*x;}],{strokeColor:'#000',strokeWidth:2, highlight: false});
 yGlider = board.create('glider',[theFct],{name:'y', highlight: false,strokeColor:'#013081',fillColor:'#013081'});
 yGlider.moveTo([1.68,0.56])
 board.create('tangent', [yGlider], {strokeColor:'#FF9900',strokeWidth:2, highlight: false});
 xGlider = board.create('glider',[theFct],{name:'x', highlight: false,strokeColor:'#013081',fillColor:'#013081'});
 xGlider.moveTo([5.83,6.79])



 c = yGlider.Y()-2*theSlider.Value()*yGlider.X()**2
 yout = 2*theSlider.Value()*yGlider.X()*xGlider.X()+c
 jl = board.create('segment',[xGlider,[xGlider.X(),yout]],{strokeColor:'#013081',strokeWidth:3, highlight: false});

 board.create('text',[1,8,
  function(){
    var distance = Math.round((xGlider.Y()-yout)**2* 100) / 100
    return '||x-y||^2 = '+distance;
  }], {fontSize: 15,},position='u')
 xGlider.on('up', function(e){
    c = yGlider.Y()-2*theSlider.Value()*yGlider.X()**2
    yout = 2*theSlider.Value()*yGlider.X()*xGlider.X()+c
    board.removeObject(jl);
    board.update()
    jl = board.create('segment',[xGlider,[xGlider.X(),yout]],{strokeColor:'#013081',strokeWidth:3, highlight: false});
});
yGlider.on('up', function(f){
  board.removeObject(jl);
  c = yGlider.Y()-2*theSlider.Value()*yGlider.X()**2
  yout = 2*theSlider.Value()*yGlider.X()*xGlider.X()+c
  jl= board.create('segment',[xGlider,[xGlider.X(),yout]],{strokeColor:'#013081',strokeWidth:3, highlight: false});
  board.update()
});

theSlider.on('down', function(h){
   board.removeObject(jl);
});



</script>
<br>
<br>
</p>
<p class='body-text'>
  Handily, if we state explicitly that our distance measure must be non-negative
  we can redefine our distance measure as
  $$d^2(x,y) := f(x) - (f(y) + \langle\nabla f(y),x-y\rangle) \geq 0$$
  This tells us that function must lie above the tangent line for all \(x,y\)
  and gives the following inequality.
  $$f(x) \geq f(y) + \langle\nabla f(y),x-y\rangle $$
  Which is precisely the definition, assuming the function is appropriately
  differentiable, the definition of a convex function.
  <br>
  <br>
<span class="bold">Exploration of the formal definition</span>
The complete definition of a bregman divergence is presented below
<br>
  <span style='font-size: 30px; color: var(--smile);'>·</span>let F : \( \Omega
  \rightarrow \mathbb{R} \) is <color style='color: var(--smile);weight: Bold;'>continuously differentiable</color> &
 <color style='color: var(--smile);weight: Bold;'>strictly convex</color> function on the <color style='color: var(--smile);weight: Bold;'>convex set</color> \(\Omega\) with two n-dimensional
 points \(x,y \in \Omega\)<br>

 <span style='font-size: 30px; color: var(--smile);'>·</span>
  \( F(x) - (F(y) + \langle\nabla F(y),x-y\rangle) \)<br>
  <span style='font-size: 30px; color: var(--smile);'>·</span>The difference
   between the function evaluated at x and the first order Taylor approximation
   of F around y evaluated at x<br>

<br>
</p>
<p >
<nav style='width:45%;margin:auto;'>
  <div class="nav nav-tabs" id="nav-tab" role="tablist">
    <a  style='color: #000'class="nav-item nav-link body-text" id="nav-convex-tab" data-toggle="tab"
    href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false">Convex Set</a>
    <a style='color: #000' class="nav-item nav-link active body-text" id="nav-contdiff-tab" data-toggle="tab"
    href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="false">
  Continuously Differentiable</a>
    <a style='color: #000' class="nav-item nav-link body-text" id="nav-strcon-tab" data-toggle="tab"
    href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">Strictly Convex</a>

  </div>
</nav>
<div class="tab-content card body-text" id="nav-tabContent" style='width:45%;margin:auto;'>
  <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-contdiff-tab">
    The derivative must also be continuous.</div>
  <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-strcon-tab">
    A function such that any straight
    line between any pair of points
    on the curve is above the curve excluding the intersection of the line and the
    curve.
  </div>

  <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-convex-tab">
    The definition of strict convexity is a function such that any straight
    line between any pair of points
    on the curve is above the curve including the intersection of the line and the
    curve.
    <!--
    <div id="box2" class="jxgbox" style="width:90%; height:50vh; margin: auto;"></div>
    <script type="text/javascript">
     var board2 = JXG.JSXGraph.initBoard('box2', {boundingbox: [-10, 10, 10, -1]
       , axis:true, showNavigation:false});
     function2 = board2.create('functiongraph',
       [function(x){return 0.1*x*x;}],{strokeColor:'#000',strokeWidth:2, highlight: false});


    Glider1 = board2.create('glider',[function2],{name:'x1', highlight: true,
    strokeColor:'#013081',fillColor:'#013081',fillOpacity: 0, strokeWidth: 1});
    Glider1.moveTo([-3,0.9])

    Glider2 = board2.create('glider',[function2],{name:'x2', highlight: false,
    strokeColor:'#013081',fillColor:'#013081',fillOpacity: 0, strokeWidth: 1});
    Glider2.moveTo([3,0.9])

    var segment = board2.create('segment',[Glider1,Glider2],{strokeColor:'#013081',strokeWidth:3, highlight: false})


      Glider1.on('up', function(e){
        x_interval = [Glider1.X(), Glider2.X()];
     });
     Glider2.on('up', function(e){
       x_interval = [Glider1.X(), Glider2.X()];
    });
    var x_interval = [Glider1.X(), Glider2.X()];
       var wrap = function(x) {
          var y = theSlider.Value()*x*x;
          if (x_interval[0] < x && x < x_interval[1]
      ) {
          return y;
      } else {
          return NaN;
      }
  }
     fct_seg = board2.create('functiongraph',
       [wrap,-10,10],{strokeColor:'#FF9900',strokeWidth:2, highlight: false});

     </script>--></div>
</div>
</p>


<br>
</section>
<section class='panel'>
<h2 class="body-header">Plots for Various Loss functions</h2>
<p class='body-text'>
  <span style='font-size: 30px; color: var(--smile);'>·</span>input function - done<br>
  <span style='font-size: 30px; color: var(--smile);'>·</span>check convexity - done <br>
  <span style='font-size: 30px; color: var(--smile);'>·</span>plot function
  (slider for p,q)<br>
  <span style='font-size: 30px; color: var(--smile);'>·</span>plot bregman div<br>
</p>
<br>
<h2 class="body-header">Convexity Checker: </h2>
<br>
<p style='width:45%;margin:auto;text-align:center;'>

<input class="btn btn-primary" onclick="reset_panels()" type="reset" value="↺ Reset">
<br>
<br>
<div id='inputeq' class='body-text' style='width:45%;margin:auto;text-align: center'>
    <p> Please enter your continuous function of class \(f:\mathbb{R}^n \rightarrow \mathbb{R}\)</p>
    <label for="lossfunc">Generator function</label>
    <input type="text" id="lossfunc">
    <p>The function must have a second derivative that exists for computation tractability</p>
    <button class="btn btn-primary" id="generate" onclick="generate()">Generate</button>
    <br>
</div>
<div id='panel2' class = 'body-text' style='margin:auto;text-align: center;
display:none;'>
<div  id="eqhead">
  Inputted Equation:
</div>
<span id="lossfuncoutput"></span>
<div id='bounds_boxes'></div>
<div style='text-align:center' id='buttoncontainer'></div>
<button class="btn btn-primary" id="generate2" onclick="generate2()">Submit</button>
</div>
<div style='width:45%;margin:auto;text-align: center;display:none;'  id=panel3>
  <div style='text-align:center;margin:auto;' id='convexity_test'></div>

  </div>


</p>
<script>
    var inputeq = document.getElementById('inputeq');
    var panel2 = document.getElementById('panel2');
    var output = document.getElementById('lossfuncoutput');
    var input = document.getElementById('lossfunc');
    var container = document.getElementById('buttoncontainer');
    var var_error = document.getElementById('variable_error')
    var bounds = document.getElementById('bounds_boxes')
    var convexity_div = document.getElementById('convexity_test')

    function generate() {
        try {
            inputted_equation = nerdamer(input.value)
            vars = nerdamer(input.value).variables()
            vars = vars.filter(onlyUnique);
            katex.render(nerdamer(input.value).toTeX(),lossfuncoutput);
            inputeq.style.display='none';
            panel2.style.display='block'
            variables = []
            vars.forEach(function(variable){
               outer = document.createElement('div')
               outer.setAttribute('class','input-group')
               innerdiv = document.createElement('div')
               innerdiv.setAttribute('class','input-group-prepend')
               text = document.createElement('span')
               text.innerHTML = 'Stepsize & Lower/Upper bounds for: '+variable+' ';
               text.setAttribute('class','input-group-text')
               innerdiv.appendChild(text)
               inp1 = document.createElement('input')
               inp1.setAttribute('type','number')
               inp1.setAttribute('class','form-control')
               inp1.setAttribute('id',variable+'lbound')
               inp2 = document.createElement('input')
               inp2.setAttribute('type','number')
               inp2.setAttribute('class','form-control')
               inp2.setAttribute('id',variable+'ubound')
               inp3 = document.createElement('input')
               inp3.setAttribute('type','number')
               inp3.setAttribute('class','form-control')
               inp3.setAttribute('id','stepsize')
               outer.appendChild(innerdiv)
               outer.appendChild(inp1)
               outer.appendChild(inp2)
               outer.appendChild(inp3)
               bounds.appendChild(outer)
               variables.push(variable)
           });

        } catch (e) {
            alert(e.message);
        }
    }
    function generate2(){
      panel2.style.display = 'none';
      panel3 = document.getElementById('panel3');
      panel3.style.display = 'block';
      var inputs = panel2.querySelectorAll("input");
      bounds=[]
      inputs.forEach(function(k){
        bounds.push(parseFloat(k.value))
      })
      stepsizes = []
      var i = Math.floor(bounds.length / 3);

      while (i--) {
        stepsizes.push(bounds[(i + 1) * 3 - 1])
        bounds.splice((i + 1) * 3 - 1, 1);
      }
      if(isConvex(inputted_equation,bounds,variables)==true){
        writing = document.createElement('div')
        katex.render(nerdamer(input.value).toTeX(),writing);
        morewriting = document.createElement('p')
        morewriting.innerHTML = 'Congratulations your function: '
        lastwriting = document.createElement('p')
        lastwriting.innerHTML = 'Is strictly convex'
        convexity_div.appendChild(morewriting)
        convexity_div.appendChild(writing)
        convexity_div.appendChild(lastwriting)
        button.classList.add("btn","btn-primary")
        button.setAttribute('id','generate3')

        button.onclick = plot_user_breg(plot_data)
        button.innerHTML = 'Plot.'
        convexity_div.appendChild(button)


      } else{
        writing = document.createElement('div')
        katex.render(nerdamer(input.value).toTeX(),writing);
        morewriting = document.createElement('p')
        morewriting.innerHTML = 'Unfortunately your function: '
        lastwriting = document.createElement('p')
        lastwriting.innerHTML = 'Is not strictly convex'
        convexity_div.appendChild(morewriting)
        convexity_div.appendChild(writing)
        convexity_div.appendChild(lastwriting)
      }

    }

  function isConvex(fn, bounds,variables) {
      //function that evaluates at midpoint and compares to assess if
      // function convex over bounds

        first_diff=[]
        variables.forEach(function(k){
          first_diff.push(nerdamer.diff(fn,k))
        })
        second_diff = []
        first_diff.forEach(function(f_dif){
          variables.forEach(function(k){
            second_diff.push(nerdamer.diff(f_dif,k))
          })
        })
        linspaces = []
        var j = 0
        for (var i=0;i<variables.length;i+=1){
          linspaces.push(linspace(bounds[j],bounds[j+1],stepsizes[i]))
          j=j+2
        }
        let f = (a, b) => [].concat(...a.map(a => b.map(b => [].concat(a, b))));
        let cartesian = (a, b, ...c) => b ? cartesian(f(a, b), ...c) : a;
        points_to_eval = cartesian(...linspaces)
        for (var i=0;i<points_to_eval.length;i+=1){
            hessian = [...Array(variables.length)].map(e => Array(variables.length))
            max = variables.length
            c=0
            second_diff.forEach(function(k){
              temp_f = k.buildFunction(variables)
              if (variables.length > 1){
                hessian[Math.floor(c/max)][c%max] = temp_f(...points_to_eval[i])
              } else{
                hessian[Math.floor(c/max)][c%max] = temp_f(points_to_eval[i])
              }

              c=c+1
            })

          hessian = math.matrix(hessian)
          eigenvalues = math.eigs(hessian).values
          //console.log(eigenvalues)
          for (var k=0;k<eigenvalues._size;k+=1){
            if(eigenvalues._data[k] <0 || math.im(eigenvalues._data[k])!=0){
              return false;

            };
          };
        };
        return true;
    }

    function linspace(start, stop,dt, endpoint = true) {
        const step = dt;
        const num = (1/dt)*((stop -start)  )+1
        return Array.from({length: num}, (_, i) => start + step * i);
    }



    function reset_panels() {
      counter=0
      panel2.style.display = "none";
      inputeq.style.display = "block";
      var errs = document.getElementsByClassName('bregplotserr')
      for (var i=0;i<errs.length;i+=1){
          errs[i].style.display = 'none';
          }
      bounds = document.getElementById('bounds_boxes')
      bounds.innerHTML = ''
      convexity_test = document.getElementById('convexity_test')
      convexity_test.innerHTML=''

    }

    function onlyUnique(value, index, self) {
      return self.indexOf(value) === index;
    }
</script>
<br>
<br>
<h2 class="body-header">Common Loss Functions:</h2>
<div style='width:45%;margin:auto;text-align:center;'>
  <div class="btn-group dropdown">
    <button style='margin:auto;' class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Divergence:
    </button>

    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
      <li><span class="dropdown-item-text">Select a Divergence: </span></li>
      <a class="dropdown-item" id='sql'>Squared Loss</a>
      <a class="dropdown-item" id='lgl'>Logistic Loss</a>
      <a class="dropdown-item" id='isd'>Itakura-Saito Distance</a>
      <a class="dropdown-item" id='sed'>Squared Euclidean Distance</a>
      <a class="dropdown-item" id='kld'>KL Divergence</a>
      <a class="dropdown-item" id='gid'>Generalised I-Divergence</a>
    </div>

  </div>
  <script>
    const SQL = {
          domain:  reals,
          phi: nerdamer('x**2'),
          dphi: nerdamer('(x-y)**2'),
          name: 'Squared Loss',
          bounds: [-10, 10, 10, -1],
          get fcn() {
                  f = this.phi.buildFunction()
                  return f;
                },
        }
    const LGL = {
          domain: '[0,1]',
          phi: nerdamer('x*log(x)+(1-x)*log(1-x)'),
          dphi: nerdamer('x*log(x/y)+(1-x)*log((1-x)/(1-y))'),
          name: 'Logistic Loss',
          bounds: [-0.2, 0.2, 1.2, -1.2],
          get fcn() {
                  f = this.phi.buildFunction()
                  return f;
                },
      }
    const ISD = {
          domain: realplusplus,
          phi: nerdamer('-log(x)'),
          dphi: nerdamer('x/y - log(x/y)-1'),
          name: 'Itakura-Saito Distance',
          bounds: [-1,10,10,-10],
          get fcn() {
                  f = this.phi.buildFunction()
                  return f;
                },
        }
    const SED = {
          domain: reald,
          phi: nerdamer('abs(x)**2'),
          dphi: nerdamer('abs(x-y)**2'),
          name: 'Squared Euclidean Distance',
          bounds: [-10, 10, 10, -1],
          get fcn() {
                  f = this.phi.buildFunction()
                  return f;
                },
        }
        const KLD = {
              domain: 'd-Simplex',
              phi: KLDphi,
              dphi: KLDdphi,
              name: 'KL-Divergence',
              bounds: [-0.2, 0.2, 1.2, -1.2],
              get fcn() {
                      f = nerdamer('x*log(x)').buildFunction()
                      return f;
                    },
            }
        const GID = {
              domain: realdplus,
              phi: GIDphi,
              dphi: GIDdphi,
              name: 'Generalised I-Divergence',
              bounds: [-0.2, 10, 10, -1],
              get fcn() {
                      f = nerdamer('x*log(x)').buildFunction()
                      return f;
                    },
            }
        const divergences = {
          sql: SQL,
          lgl: LGL,
          isd: ISD,
          sed: SED,
          kld: KLD,
          gid: GID,
        }
    $(document).ready(function () {
    $(".dropdown").hover(function(){
        $(".dropdown-item").on("click",(function(){
            dom = document.getElementById('DOM')
            phi = document.getElementById('PHI')
            dphi = document.getElementById('DPHI')
            div = document.getElementById('DIV')
            //katex.render(,dom)
            katex.render(divergences[this.id].domain, dom);
            div.innerHTML = divergences[this.id].name
            if(this.id=='kld'||this.id=='gid'){
              katex.render(divergences[this.id].phi,phi)
              katex.render(divergences[this.id].dphi,dphi)
              old_board = document.getElementById('box2')
              old_board.style.display = 'none'
              bin_board = document.getElementById('box4')
              KLD_board = document.getElementById('box3')
              old_board.style.display = 'none'
              bin_board.style.display = 'block'
              KLD_board.style.display = 'block'
            }else{
              katex.render(divergences[this.id].phi.toTeX(), phi);
              katex.render(divergences[this.id].dphi.toTeX(), dphi);
              old_board = document.getElementById('box2')
              old_board.style.display = 'none'
              bin_board = document.getElementById('box4')
              KLD_board = document.getElementById('box3')
              old_board.style.display = 'block'
              bin_board.style.display = 'none'
              KLD_board.style.display = 'none'
            }
            cur_mode = divergences[this.id].fcn
            cur_dphi = divergences[this.id].dphi.buildFunction()
            board2.setBoundingBox(divergences[this.id].bounds)
            board2.removeObject(target)
            board2.removeObject(free)
            board2.removeObject(tangent)
            target = board2.create('glider',[divergence],{name:'target', highlight: false,strokeColor:'#013081',fillColor:'#013081'});
            tangent = board2.create('tangent', [target], {strokeColor:'#FF9900',strokeWidth:2, highlight: false});
            free = board2.create('glider',[divergence],{name:'free', highlight: false,strokeColor:'#013081',fillColor:'#013081'});
            board2.update()


      }));
      });
 });
    </script>
    <br><br>
</div>
<table style='width:80%;margin:auto;' class="table" id='divtable'>
  <thead>
    <tr>
      <th scope="col">Domain</th>
      <th scope="col">\( \bold{\phi(x)} \)</th>
      <th scope="col">\( d_{\phi}(x,y) \)</th>
      <th scope="col">Divergence</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th scope="row" id='DOM'>\(\reals\)</th>
      <td id= 'PHI'>\(x^2\)</td>
      <td id='DPHI'>\((x-y)^2\)</td>
      <td id='DIV'>Squared Loss</td>
    </tr>
  </tbody>
</table>
<div id="box2" class="jxgbox" style="margin-top:100%;left:0%;width:70%; height:50vh; margin: auto;"></div>
<script type="text/javascript">
var cur_mode = SQL.fcn
var cur_dphi = SQL.dphi.buildFunction(['x','y'])
var board_bounds = [-10, 10, 10, -1]
function f(x,mode){
  return mode(x)
}
 var board2 = JXG.JSXGraph.initBoard('box2', {boundingbox: board_bounds, axis:true, showNavigation:false});
  board2.options.text.cssStyle = 'font-family: "Amazon Ember Mono"'
  divergence = board2.create('functiongraph', [function(x){ return f(x,cur_mode); },-10, 10],{strokeColor:'#000',strokeWidth:2, highlight: false});
  target = board2.create('glider',[divergence],{name:'target', highlight: false,strokeColor:'#013081',fillColor:'#013081'});
  tangent = board2.create('tangent', [target], {strokeColor:'#FF9900',strokeWidth:2, highlight: false});
  free = board2.create('glider',[divergence],{name:'free', highlight: false,strokeColor:'#013081',fillColor:'#013081'});
  tang_f = nerdamer.diff(SQL.phi,'x').buildFunction()
  breg_val = cur_dphi(free.X(),target.X())
   line_seg = board2.create('segment',[free,[free.X(),free.Y()-breg_val]],{strokeColor:'#013081',strokeWidth:3, highlight: false,label:{autoPosition: true, offset:[10, 10]}});
   board2.on('up', function(f){
     breg_val = cur_dphi(free.X(),target.X())
     board2.removeObject(line_seg)
     board2.update()
     line_seg = board2.create('segment',[free,[free.X(),free.Y()-breg_val]],{strokeColor:'#013081',strokeWidth:3, highlight: false,label:{autoPosition: true, offset:[10, 10]}});
     line_seg.setLabel('D(x||y)= '+Math.round(breg_val*100)/100)
   });


</script>
<div id="box4" class="jxgbox" style="display:none;margin-top:100%;left:0%;width:35%; height:20vh; margin: auto;"></div>
<div id="box3" class="jxgbox" style="display:none;margin-top:100%;left:0%;width:70%; height:50vh; margin: auto;"></div>
<script type="text/javascript">
bin_one = [20,0.7];
var board3 = JXG.JSXGraph.initBoard('box3', {boundingbox: [-0.1,2,1,-0.1], axis:true, showNavigation:false});
function KLB(x,params){
  a = Math.log(params[1]/x)*params[0]*params[1]
  b= Math.log((1-params[1])/(1-x))*params[0]*(1-params[1])
  //console.log(a+b)
  return a + b
}
divergence_p = board3.create('functiongraph', [function(x){ return KLB(x,bin_one); },0, 1],{strokeColor:'#000',strokeWidth:2, highlight: false});
target_p = board3.create('slider',[[0.05,0.1],[0.2,0.1],[0,bin_one[1],1]],{snapWidth:0.05,label:{autoPosition: true, offset:[100, 100]}});
target_p.setLabel('Target Parameter: p')
free_p = board3.create('glider',[divergence_p],{name:'free', highlight: false,strokeColor:'#013081',fillColor:'#013081'});
tangent_p = board3.create('segment',[[-0.2,0],[1,0]],{strokeColor:'#FF9900',strokeWidth:1.2, highlight: false,label:{autoPosition: true, offset:[1, 1]}});
breg_val = KLB(free_p.X(),bin_one)
line_seg_p = board3.create('segment',[free_p,[free_p.X(),free_p.Y()-breg_val]],{strokeColor:'#013081',strokeWidth:3, highlight: false,label:{autoPosition: true, offset:[10, 10]}});
 board3.on('up', function(f){
   //dist_box = [-3,0.3,Math.round(bin_one[0]),-0.05]
   board3.removeObject(line_seg_p)
   breg_val = KLB(free_p.X(),bin_one)
   console.log(breg_val)
   distribution_free = stats.binomialDistribution(bin_one[0],free_p.X());
   board4.removeObject(chart_free)
   //board4.removeObject(free)
   board4.update()
   board3.update()
   chart_free = board4.create('chart', distribution_free, {
            chartStyle:'bar',
            color:'#013081',
            width:0.1,
            labels:f,
            shadow:true
   });
   line_seg_p = board3.create('segment',[free_p,[free_p.X(),free_p.Y()-breg_val]],{strokeColor:'#013081',strokeWidth:3, highlight: false,label:{autoPosition: true, offset:[10, 10]}});
   line_seg_p.setLabel('D(p||q)= '+Math.round(breg_val*100)/100)
 });
target_p.on('up', function(f){
  bin_one[1] = target_p.Value()
  board3.removeObject(divergence_p)
  //board3.removeObject(target)
  board3.update()
  divergence_p = board3.create('functiongraph', [function(x){ return KLB(x,bin_one); },0, 1],{strokeColor:'#000',strokeWidth:2, highlight: false});
  free_p = board3.create('glider',[divergence_p],{name:'free', highlight: false,strokeColor:'#013081',fillColor:'#013081'});
  var distribution = stats.binomialDistribution(...bin_one);
  board4.removeObject(chart)
  board4.update()
  chart = board4.create('chart', distribution, {
           chartStyle:'bar',
           color:'#FF9900',
           width:0.1,
           labels:f,
           shadow:true
  });
  board3.update()

});

dist_box = [-3,0.3,bin_one[0]+2,-0.05]
var board4 = JXG.JSXGraph.initBoard('box4', {boundingbox: dist_box , axis:true, showNavigation:false});
var data = [
	{ ID: 1, age: 33 },
	{ ID: 2, age: 42 },
	{ ID: 3, age: 27 },
];

var columns = {
	ID: 'ordinal',
	age: 'interval'
};

var settings = {};
var stats = new Statistics(data, columns, settings);
var distribution = stats.binomialDistribution(...bin_one);
var distribution_free = stats.binomialDistribution(bin_one[0],free.X());
var chart = board4.create('chart', distribution, {
         chartStyle:'bar',
         color:'#FF9900',
         width:0.1,
         labels:f,
         shadow:true
});
var chart_free = board4.create('chart', distribution_free, {
         chartStyle:'bar',
         color:'#013081',
         width:0.1,
         labels:f,
         shadow:true
});
</script>
</section>



</body>
